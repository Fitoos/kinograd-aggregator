<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ –ö–∏–Ω–æ–ì—Ä–∞–¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ */
        body {
            background-color: #1a202c; /* bg-gray-900 */
            color: #f7fafc; /* text-gray-100 */
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ (–æ–≤–µ—Ä–ª–µ—è) */
        .modal {
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
        }
        .modal.open {
            display: flex;
        }
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Å—Ç–µ—Ä –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
        .modal-poster {
            aspect-ratio: 2/3;
        }
        /* –°—Ç–∏–ª—å –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .movie-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            background-color: #2d3748; /* bg-gray-700 */
        }
        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px -5px rgba(246, 115, 0, 0.2); /* –û—Ä–∞–Ω–∂–µ–≤–∞—è —Ç–µ–Ω—å */
        }
    </style>
</head>
<body>

    <header class="bg-gray-800 p-4 shadow-xl sticky top-0 z-10 border-b-4 border-orange-600">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-3xl font-extrabold text-white mb-3 md:mb-0 cursor-pointer" onclick="fetchMovies()">‚≠ê –ö–∏–Ω–æ–ì—Ä–∞–¥</h1>
            <div class="w-full md:w-1/3">
                <input 
                    type="text" 
                    id="search-input" 
                    placeholder="–ù–∞–π—Ç–∏ —Ñ–∏–ª—å–º –∏–ª–∏ —Å–µ—Ä–∏–∞–ª..." 
                    class="w-full p-2 rounded-lg border border-gray-600 bg-gray-700 text-white focus:ring-2 focus:ring-orange-500"
                >
            </div>
        </div>
    </header>
    
    <div class="bg-gray-800 py-4 border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-6 flex flex-col sm:flex-row gap-4 items-center justify-between">
            
            <div class="flex flex-wrap gap-4 items-center">
                <label for="content-type" class="text-gray-400 font-semibold text-sm">–¢–ò–ü:</label>
                <select id="content-type" class="p-2 rounded-lg bg-gray-700 border border-gray-600 text-white focus:ring-orange-500" onchange="fetchMovies()">
                    <option value="movie">–§–∏–ª—å–º—ã</option>
                    <option value="tv">–°–µ—Ä–∏–∞–ª—ã</option>
                </select>
                
                <label for="genre-filter" class="text-gray-400 font-semibold text-sm">–ñ–ê–ù–†:</label>
                <select id="genre-filter" class="p-2 rounded-lg bg-gray-700 border border-gray-600 text-white focus:ring-orange-500" onchange="fetchMovies()">
                    <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                    </select>
            </div>
            
            <button onclick="fetchTrending()" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                üî• –¢—Ä–µ–Ω–¥—ã –Ω–µ–¥–µ–ª–∏
            </button>
            
        </div>
    </div>

    <main class="max-w-7xl mx-auto p-6">
        <h2 id="section-title" class="text-3xl font-semibold mb-8 text-white">–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –§–∏–ª—å–º—ã</h2>
        
        <div id="movies-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
            </div>

        <p id="message" class="text-center text-xl mt-10 text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
    </main>

    <div id="movie-modal" class="modal fixed inset-0 z-50 items-center justify-center p-4">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden relative">
            
            <button onclick="closeModal()" class="absolute top-3 right-3 text-orange-400 hover:text-orange-600 text-3xl font-bold p-1 leading-none z-20">
                &times;
            </button>
            
            <div id="modal-content" class="p-6">
                </div>
        </div>
    </div>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
        const API_KEY = '6ba774858ac337da097ab96ca608fce8';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/'; 
        const PAGE_COUNT = 3; // –ó–∞–≥—Ä—É–∑–∫–∞ 3 —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–¥–æ 60 —à—Ç.)

        // === –°–°–´–õ–ö–ò –ù–ê –≠–õ–ï–ú–ï–ù–¢–´ DOM ===
        const container = document.getElementById('movies-container');
        const messageElement = document.getElementById('message');
        const sectionTitle = document.getElementById('section-title');
        const searchInput = document.getElementById('search-input');
        const modal = document.getElementById('movie-modal');
        const modalContent = document.getElementById('modal-content');
        const genreFilter = document.getElementById('genre-filter');
        const contentTypeSelect = document.getElementById('content-type');
        const body = document.body; 

        // === –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò UX ===

        // –ù–û–í–û–ï: –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –æ–≤–µ—Ä–ª–µ–µ
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        function closeModal() {
            modal.classList.remove('open');
            // –ù–û–í–û–ï: –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            body.style.overflow = ''; 
        }


        // === 1. –ó–ê–ì–†–£–ó–ö–ê –°–ü–ò–°–ö–ê –ñ–ê–ù–†–û–í ===
        async function fetchGenres() {
            try {
                const url = `${BASE_URL}/genre/movie/list?api_key=${API_KEY}&language=ru-RU`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.genres) {
                    data.genres.forEach(genre => {
                        const option = document.createElement('option');
                        option.value = genre.id;
                        option.textContent = genre.name;
                        genreFilter.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∂–∞–Ω—Ä–æ–≤:', error);
            }
        }


        // === 2. –ü–û–õ–£–ß–ï–ù–ò–ï –ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –û–°–ù–û–í–ù–û–ì–û –ö–û–ù–¢–ï–ù–¢–ê ===

        async function fetchMovies(query = null) {
            
            const contentType = contentTypeSelect.value;
            const selectedGenre = genreFilter.value;
            const isSearching = query && query.length > 0;

            messageElement.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';
            messageElement.style.display = 'block';
            container.innerHTML = '';
            
            let allResults = [];
            let typeTitle = contentType === 'movie' ? '–§–∏–ª—å–º—ã' : '–°–µ—Ä–∏–∞–ª—ã';

            sectionTitle.textContent = isSearching 
                ? `–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ ${typeTitle}: "${query}"`
                : selectedGenre 
                    ? `–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ ${typeTitle} –ø–æ –∂–∞–Ω—Ä—É`
                    : `–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ ${typeTitle}`;


            try {
                for (let page = 1; page <= (isSearching ? 1 : PAGE_COUNT); page++) {
                    let url;
                    if (isSearching) {
                        url = `${BASE_URL}/search/${contentType}?api_key=${API_KEY}&language=ru-RU&query=${encodeURIComponent(query)}&page=${page}`;
                    } else {
                        let filterParams = selectedGenre ? `&with_genres=${selectedGenre}` : '';
                        url = `${BASE_URL}/discover/${contentType}?api_key=${API_KEY}&language=ru-RU&sort_by=popularity.desc&page=${page}${filterParams}`;
                    }

                    const response = await fetch(url);
                    if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ API –∫–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω.');
                    
                    const data = await response.json();
                    if (data.results) {
                        allResults = allResults.concat(data.results);
                    }
                    if (isSearching || page >= data.total_pages) break;
                }
                
                if (allResults.length > 0) {
                    displayContent(allResults);
                } else {
                    messageElement.textContent = isSearching 
                        ? `–ü–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.` 
                        : '–ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.';
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                messageElement.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        // === 3. –õ–û–ì–ò–ö–ê –ü–û–î–ë–û–†–û–ö (–¢–†–ï–ù–î–´) ===

        async function fetchTrending() {
            messageElement.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–Ω–¥–æ–≤ –Ω–µ–¥–µ–ª–∏...';
            messageElement.style.display = 'block';
            container.innerHTML = '';
            
            sectionTitle.textContent = `üî• –í —Ç—Ä–µ–Ω–¥–µ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ (–§–∏–ª—å–º—ã –∏ –°–µ—Ä–∏–∞–ª—ã)`;

            try {
                const url = `${BASE_URL}/trending/all/week?api_key=${API_KEY}&language=ru-RU`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç—Ä–µ–Ω–¥–æ–≤.');
                
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    displayContent(data.results);
                } else {
                    messageElement.textContent = '–¢—Ä–µ–Ω–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.';
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                messageElement.textContent = `–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç—Ä–µ–Ω–¥–æ–≤: ${error.message}`;
            }
        }

        // === 4. –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ö–û–ù–¢–ï–ù–¢–ê ===

        function displayContent(items) {
            container.innerHTML = '';
            messageElement.style.display = 'none';

            items.forEach(item => {
                const contentType = item.media_type || contentTypeSelect.value;
                
                const title = item.title || item.name || '–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
                const date = item.release_date || item.first_air_date;
                const releaseYear = date ? date.split('-')[0] : 'N/A';
                const voteAverage = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
                
                const posterPath = item.poster_path;
                const posterUrl = posterPath ? `${IMAGE_BASE_URL}w500${posterPath}` : 'https://via.placeholder.com/500x750?text=–ù–µ—Ç+–ü–æ—Å—Ç–µ—Ä–∞';

                const card = document.createElement('div');
                card.className = 'movie-card rounded-lg shadow-lg overflow-hidden';
                
                if (contentType !== 'person') {
                    card.onclick = () => showMovieDetails(item.id, contentType);
                }

                card.innerHTML = `
                    <img src="${posterUrl}" alt="${title}" class="w-full object-cover aspect-[2/3] border-b border-gray-700">
                    <div class="p-3">
                        <h3 class="text-sm font-semibold truncate mb-1 text-white">${title}</h3>
                        <div class="flex justify-between items-center text-xs text-gray-400">
                            <span>${contentType === 'movie' ? '–§–∏–ª—å–º' : contentType === 'tv' ? '–°–µ—Ä–∏–∞–ª' : '–ö–æ–Ω—Ç–µ–Ω—Ç'}: ${releaseYear}</span>
                            <span class="font-bold text-orange-500">
                                <span class="mr-1">‚òÖ</span>${voteAverage}
                            </span>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // === 5. –õ–û–ì–ò–ö–ê –ü–û–ò–°–ö–ê ===

        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const query = e.target.value.trim();
                fetchMovies(query || null); 
            }, 500);
        });

        // === 6. –õ–û–ì–ò–ö–ê –î–ï–¢–ê–õ–ï–ô (–ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û) ===

        async function showMovieDetails(itemId, contentType) {
            // –ù–û–í–û–ï: –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            body.style.overflow = 'hidden'; 
            
            const itemType = contentType === 'person' || !contentType ? 'movie' : contentType; 

            modalContent.innerHTML = `<p class="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π...</p>`;
            modal.classList.add('open'); 

            try {
                const url = `${BASE_URL}/${itemType}/${itemId}?api_key=${API_KEY}&language=ru-RU`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏.');
                
                const details = await response.json();
                
                const title = details.title || details.name;
                const date = details.release_date || details.first_air_date;
                const releaseYear = date ? date.split('-')[0] : 'N/A';
                const posterUrl = details.poster_path ? `${IMAGE_BASE_URL}w300${details.poster_path}` : 'https://via.placeholder.com/300x450?text=–ù–µ—Ç+–ü–æ—Å—Ç–µ—Ä–∞';
                const genres = details.genres ? details.genres.map(g => g.name).join(', ') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                
                let runtime = 'N/A';
                if (details.runtime) {
                    runtime = `${details.runtime} –º–∏–Ω.`;
                } else if (details.episode_run_time && details.episode_run_time.length > 0) {
                    runtime = `${details.episode_run_time[0]} –º–∏–Ω. / —ç–ø–∏–∑–æ–¥`;
                }
                
                const rating = details.vote_average ? details.vote_average.toFixed(1) : 'N/A';
                const overview = details.overview || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.';

                modalContent.innerHTML = `
                    <div class="flex flex-col md:flex-row gap-6">
                        <div class="md:w-1/3 flex-shrink-0">
                            <img src="${posterUrl}" alt="${title}" class="w-full rounded-lg shadow-xl modal-poster">
                        </div>
                        
                        <div class="md:w-2/3">
                            <h3 class="text-3xl font-extrabold text-white mb-2">${title} (${releaseYear})</h3>
                            
                            <div class="flex flex-wrap items-center space-x-4 mb-4 text-sm text-gray-400">
                                <span class="bg-orange-600 text-white px-3 py-1 rounded-full font-semibold text-base shadow-lg">
                                    ‚òÖ ${rating}
                                </span>
                                <span>${runtime}</span>
                                <span>${genres}</span>
                            </div>

                            <p class="text-white mb-3 font-semibold text-lg">–°—é–∂–µ—Ç:</p>
                            <p class="text-sm text-gray-300 max-h-40 overflow-y-auto pr-2">${overview}</p>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ—Ç–∞–ª–µ–π:', error);
                modalContent.innerHTML = `<p class="text-red-400 text-center">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ—Ç–∞–ª–µ–π.</p>`;
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: –∑–∞–≥—Ä—É–∂–∞–µ–º –∂–∞–Ω—Ä—ã, –∑–∞—Ç–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–ª—å–º—ã
        fetchGenres().then(() => fetchMovies());
    </script>

</body>
</html>
